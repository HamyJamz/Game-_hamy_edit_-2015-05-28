<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">

	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="mobile-web-app-capable" content="yes">

	<title>Canvas Game </title>

	<script src="sprite.js"></script>

    
	<style>
	canvas {
		display: block;
		position: absolute;
		margin: auto;
		top: 0;
		bottom: 0;
		left: 0;
		right: 0;
	}
	</style>
	
</head>
<body>

    <script>
        document.body.addEventListener("keydown", function(e) {
        keys[e.keyCode] = true;
        });
        
        document.body.addEventListener("keyup", function(e) {
        keys[e.keyCode] = false;
        });  
    
        var
        keys = [],
        canvas,
        ctx,
        x,
        y,
        width,
        height,
        frames=0,
        fg_posX=0,
        fg_posY=0,
        bg_posX=0,
        txtStr,
        
        NB,
        EB,
        SB,
        WB,
        
        
        currentstate,
        
        states = {
            Title:0, Splash:1, Intro:2, Tutorial:3, World1:4, World2:5, Space:6, Pause:7
        },
        
        
        bird = {
            /*
            height: 98,
            width: 80,
            */
            height:24,
            width:34,
            
            x: 100,
            y: 480 ,
            
            speed: 2,
            velX: 0,
            velY: 0,
            
            gravity:0.25,
            friction: 0.85,
            _jump:8,
            
            frame: 0,
            idle: [0,1,2,1],
            jumping: false,
            FacingL: false,
            FacingR: true,
            RunR: false,
            RunL: false,
            
            

            
            moveRight:function(){
                this.velX++;    
               
                console.log("RIGHT");
            },
            
            moveLeft:function(){
                this.velX--;  

                this.facingR = false;
                this.facingL = true;
                console.log("LEFT");
            },
            
            jump:function(){
                if(!this.jumping){
                   this.jumping = true;
                   this.velY = -this._jump;
                   
                 }
            },
            
            update: function(){
                /*if current state is splash n=10 */
                var n = currentstate ==states.Splash ? 10 : 5;
                /* if frame mod n is = zero increment else keep at current frame  */
                this.frame += frames %n === 0? 1:0;
                this.frame %= this.idle.length;
                

                /*added stuff */
                // check keys
                if (keys[38] || keys[32]) {
                    // up arrow or space
                        this.jump();
                }
                if (keys[39]) {
                    // right arrow
                    if (this.velX < this.speed) {             
                         this.moveRight();           
                     }     
                }     
                if (keys[37]) {         
                    // left arrow         
                    if (this.velX > -this.speed) {
                        this.moveLeft();    
                    }
                }
                
              
                this.velX *= this.friction;
             
                this.velY += this.gravity;

               /*  HERO MOVEMENT ON SCREEN*/
               /*  COMMENTING THIS OUT FOR NOW !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
                this.x += this.velX;*/
                this.y += this.velY;


                /*  LEFT AND RIGHT BOUND CHECKING TO KEEP HERO ON SCREEN*/

                /*  WE AREN'T MOVING X POS RIGHT NOW SO THIS IS NOT NEEDED!!!!!!!!!!!!!!!!!
                if (this.x >= width-(2*this.width)) {
                    this.x = width-(2*this.width);
                } else if (this.x <= 0+this.width) {         
                    this.x = 0+this.width;     
                }
                
                */
              
                
                /*added stuff end*/
                
                //if at bottom go no further 
                if(this.y >= SB){
                    this.y=SB;
                    this.jumping = false;
                }
                
            },
            
            draw: function(ctx){
                ctx.save();
                var n = this.idle[this.frame];
                s_bird[n].draw(ctx, this.x, this.y);    
                ctx.restore();
            }
            
            
        };/*bird end*/







/*small change with IDE after GIT link was fixed*/


        function main(){
            canvas = document.createElement("canvas");
            width= window.innerWidth;
            height = window.innerHeight;
            
            if(width >= 500){
                width = 320;
                height = 480;
                canvas.style.border = "1px solid #000";
                
            }

            canvas.width = width;
            canvas.height = height;
            ctx = canvas.getContext("2d");
            currentstate = states.Splash;
            document.body.appendChild(canvas);
            
            var img = new Image();
            img.onload = function(){
                console.log("image loaded");
                initSprites(this);
                run();
                
            }
            img.src ="sheet.png";
            
            
        
        }
        /*end main*/

        function run(){
            var loop = function(){
                 update();
                 render();
                 window.requestAnimationFrame(loop, canvas);
            }   
            window.requestAnimationFrame(loop, canvas);     
        }
        /*end run*/
        
        
        
        function update(){
            frames++;
            /*set bounds*/
            /*EAST BOUND*/
            EB = 0;
            /*WEST BOUND*/
            WB = 0;
            /*SOUTH BOUND*/
    	    SB= height - (s_fg.height + bird.height);
    	    /*NORTH BOUND*/
    	    NB= 0 -height;



            bird.update();
            
            /*MOVE FOREGROUND*/
            fg_posX = (fg_posX - bird.velX)% 14;


            /*move background slowly*/
            /*one tenth hero velocity*/
            bg_posX = (bg_posX - bird.velX/10);

            
            
            
            
            
  
            
        }
        /*end update*/
        
        
        
        function render(){
            /*background x:fg_posX, y:fg_posY*/
            ctx.fillStyle=s_bg.color; 
            ctx.fillRect(0,0,width,height);


            /*s_bg.draw(ctx, 0, height-s_bg.height);*/
            s_bg.draw(ctx, bg_posX, height-s_bg.height);
            s_bg.draw(ctx, bg_posX+s_bg.width, height-s_bg.height);
            s_bg.draw(ctx, bg_posX-s_bg.width, height-s_bg.height);
            


            /*draw done in bird 'struct'*/
            bird.draw(ctx);
            
          /*foreground x:fg_posX, y:fg_posY */
          s_fg.draw(ctx, fg_posX, height-s_fg.height);
          s_fg.draw(ctx, fg_posX+s_fg.width, height-s_fg.height);
          s_fg.draw(ctx, fg_posX-s_fg.width, height-s_fg.height);
         
            
           
            
        }
        /*end render*/
        
        
        
        main();
        
        
    </script>
    
    
    </body>
</html>